define("head-on",[],function(){return window.headOn}),function(e,t){var n=function(){function r(e){return Object.keys(e).length===0}var t,n={groups:{},_images:{},fps:50,imagesLoaded:!0,gameTime:0,_update:"",_render:"",_ticks:0,randInt:function(e,t){return Math.floor(Math.random()*(t+1-e))+e},randFloat:function(e,t){return Math.random()*(t-e)+e},events:{events:{},listen:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},trigger:function(e){var t=[].splice.call(arguments,1),r=this.events[e],i,s;if(r){i=r.length;for(s=0;s<i;s++)r[s].apply(n,t)}}},animate:function(e,t,n){var r,i,s=0;e.animating||(e.animating=!0,e.image=t[0],r=this,i=setInterval(function(){t.length===s?(n(),e.animating=!1,e.image="",clearInterval(i)):(s+=1,e.image=t[s])},1e3/this.fps))},update:function(e){this._update=e},render:function(e){this._render=e},entity:function(e,t){var n,r,i;t&&typeof t=="object"?r=Object.create(t):r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r},collides:function(e,t){var n=this.getPoints(e),r=this.getPoints(t),i=0,s=n.length,o,u=r.length,a={x:0,y:0},f,l,c,h,p,d,v=null,m=null,g=null,y,b,w;for(;i<s;i++){b=n[i==s-1?0:i+1],w=n[i],a.x=-(b[1]-w[1]),a.y=b[0]-w[0],f=Math.sqrt(a.x*a.x+a.y*a.y),a.x/=f,a.y/=f,l=c=-1,h=p=-1;for(o=0;o<s;++o){y=n[o][0]*a.x+n[o][1]*a.y;if(y>h||h===-1)h=y;if(y<l||l===-1)l=y}for(o=0;o<u;++o){y=r[o][0]*a.x+r[o][1]*a.y;if(y>p||p===-1)p=y;if(y<c||c===-1)c=y}l<c?(d=c-h,a.x=-a.x,a.y=-a.y):d=l-p;if(d>=0)return!1;if(v===null||d>v)v=d,g={x:a.x,y:a.y}}for(i=0;i<u;i++){b=r[i==u-1?0:i+1],w=r[i],a.x=-(b[1]-w[1]),a.y=b[0]-w[0],f=Math.sqrt(a.x*a.x+a.y*a.y),a.x/=f,a.y/=f,l=c=-1,h=p=-1;for(o=0;o<s;++o){y=n[o][0]*a.x+n[o][1]*a.y;if(y>h||h===-1)h=y;if(y<l||l===-1)l=y}for(o=0;o<u;++o){y=r[o][0]*a.x+r[o][1]*a.y;if(y>p||p===-1)p=y;if(y<c||c===-1)c=y}l<c?(d=c-h,a.x=-a.x,a.y=-a.y):d=l-p;if(d>=0)return!1;if(v===null||d>v)v=d;if(d>m||m===null)m=d,g={x:a.x,y:a.y}}return{overlap:m,normal:g}},getPoints:function(e){var t=e.position.x,n=e.position.y,r=e.width,i=e.height,s=e.angle,o=this,u=[];return u[0]=[t,n],u[1]=[],u[1].push(Math.sin(-s)*i+t),u[1].push(Math.cos(-s)*i+n),u[2]=[],u[2].push(Math.cos(s)*r+u[1][0]),u[2].push(Math.sin(s)*r+u[1][1]),u[3]=[],u[3].push(Math.cos(s)*r+t),u[3].push(Math.sin(s)*r+n),u},pause:function(){this.paused=!0,this.events.trigger("pause")},unpause:function(){this.events.trigger("unpause"),this.paused=!1},isPaused:function(){return this.paused},group:function(e,t){return this.groups[e]?t&&this.groups[e].push(t):(this.groups[e]=[],t&&this.groups[e].push(t)),this.groups[e]},loadImages:function(e,t,n){var r,i,s,o,u,a,f,l,c;f=this,this.imagesLoaded=!1,s=e.length,s||(this.imagesLoaded=!0),o=0,c=function(){o+=1,t&&t(image.name),o===s&&(n&&n(),f.imagesLoaded=!0)},e.forEach(function(e){i=new Image,i.src=e.src,i.onload=c,f._images[e.name]=i})},images:function(e){return this._images[e]?this._images[e]:new Image},onTick:function(e){var t=Date.now(),n=t-e;this.trueFps=1/(n/1e3),this._ticks+=1,this._update(n,this._ticks),this._render(n,this._ticks),this.gameTime+=n},timeout:function(e,t,n){setTimeout(function(){e.call(n)},t)},interval:function(e,t,n){return setInterval(function(){e.call(n)},t)},canvas:function(e){return this===n?new this.canvas(e):(this.canvas=this.canvases[e],this.width=this.canvas.width,this.height=this.canvas.height,this)},Vector:function(e,n){var r=this.entity({x:e,y:n},t);return r},run:function(){function r(){t.imagesLoaded&&(t.onTick(n),n=Date.now()),e.requestAnimationFrame(r)}var t=this,n=Date.now();e.requestAnimationFrame(r)}};return n.canvas.create=function(e,t,n){var r,i;r=document.createElement("canvas"),r.width=t,r.height=n,i=r.getContext("2d"),this.prototype.canvases[e]={canvas:r,ctx:i,width:r.width,height:r.height}},n.canvas.prototype={canvases:{},stroke:function(e){var t=this.canvas.ctx;t.save(),e&&(t.lineWith=e.width,t.strokeStyle=e.color,t.stroke()),t.restore()},drawRect:function(e,t,n,i,s,o,u){var a=this.canvas.ctx,f=1;return a.save(),a.beginPath(),u?(a.translate(n,i),a.rotate(u),a.rect(0,0,e,t)):a.rect(n,i,e,t),s&&(a.fillStyle=s),a.fill(),typeof o=="object"&&!r(o)&&this.stroke(o),a.closePath(),a.restore(),this},drawCircle:function(e,t,n,r,i){var s=this.canvas.ctx;return s.save(),s.beginPath(),s.arc(e,t,n,0,2*Math.PI,!1),s.fillStyle=r||"black",s.fill(),this.stroke(i),s.restore(),s.closePath(),this},drawImage:function(e,t,n){var r=this.canvas.ctx;try{r.drawImage(e,t,n)}catch(i){console.log(e)}return this},drawImageRotated:function(e,t,n,r){var i=this.canvas.ctx,s=t*Math.PI/180;return i.save(),i.translate(n,r),i.rotate(s),i.drawImage(e,0-e.width,0-e.height),i.restore(),this},drawText:function(e,t,n,r,i,s,o){var u=this.canvas.ctx;return u.save(),r&&(u.font=r+" sans-serif"),i&&(u.fillStyle=i),s&&(u.textAlign=s),o&&(u.textBaseline=o),u.fillText(e,t,n),u.restore(),this},append:function(e){return e=document.querySelector(e),e?e.appendChild(this.canvas.canvas):document.body.appendChild(this.canvas.canvas),this}},t={normalize:function(){var e=this.length();return n.Vector(this.x/e,this.y/e)},normalizeInPlace:function(){var e=this.length();this.x/=e,this.y/=e},dot:function(e){return e.x*this.x+e.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},sub:function(e){return n.Vector(this.x-e.x,this.y-e.y)},add:function(e){return n.Vector(this.x+e.x,this.y+e.y)},mul:function(e){return n.Vector(this.x*e,this.y*e)}},n}();e.headOn=n}(window),define("hud",["head-on"],function(e){function r(r){r.drawRect(r.width,r.height,0,0,"white"),r.drawRect(n.width,n.height,n.x,n.y,"red"),r.drawRect(e.player.getHealth()/e.player.getMaxHealth()*n.width,n.height,n.x,n.y,"green"),r.drawText("Health: ("+Math.floor(e.player.getHealth())+"/"+e.player.getMaxHealth()+")",n.width/2+n.x,n.y+30,"15px","black","center","middle"),r.drawRect(200,20,300,10,"black"),r.drawRect(e.player.shield.getHealth()/e.player.shield.getMaxHealth()*200,20,300,10,"purple"),r.drawText("Shields",400,40,"15px","black","center","middle"),e._ticks%50===0&&(t=Math.floor(e.trueFps)),r.drawText(t+" fps",r.width-30,40),r.drawRect(200,20,600,10,"black"),r.drawRect(e.player.jetpack.getFuel()/e.player.jetpack.getMaxFuel()*200,20,600,10,"grey"),r.drawText("Jetpack Fuel",700,40,"15px","black","center","middle"),r.drawText("Active Powerups:",10,70,"16px");var i=0;for(k in e.player.powerups){var s;e.player.powerups.hasOwnProperty(k)&&(s=e.player.powerups[k],s.active&&(r.drawText(s.description+": "+Math.ceil(s.effectLength/1e3)+" s",10,90+i*20,"14px"),i++))}i===0&&r.drawText("none",10,90,"14px")}function i(){}var t,n={x:10,y:10,width:200,height:20};return{render:r,update:i}}),define("powerups",["head-on"],function(e){function n(n){var r=this;e.gameTime-this.lastSpawn>1e4&&(this.spawnPowerup(),this.lastSpawn=e.gameTime),this.powerups.forEach(function(i,s){if(i.destroy){r.powerups.splice(s,1);return}i.TTL-=n*1e3;if(i.TTL<=0){i.destroy=!0;return}e.collides(i,e.player)&&(e.player.powerup(i),r.announcePowerup(i),i.destroy=!0,e.events.trigger("powerup"),t.currentTime=0,t.play())})}function r(e){var t=12,n=70,r=0;clearInterval(this.announcementInterval),this.announcement={},this.announcement.text=e.description,this.announcement.fontSize=t+"px",this.announcementInterval=setInterval(function(){if(n===r+1){clearInterval(this.announcementInterval),this.announcement=!1;return}this.announcement.fontSize=t+r+"px",this.announcement.color="rgba(0,0,0,"+(n-r)/n+")",r+=1}.bind(this),15)}function i(t){this.powerups.forEach(function(e){e.image?t.drawImage(e.image,e.position.x,e.position.y):t.drawRect(e.width,e.height,e.position.x,e.position.y,e.color)}),this.announcement&&t.drawText(this.announcement.text,e.map.width/2,100,this.announcement.fontSize,this.announcement.color,"center")}function s(){var t=e.randInt(0,100);t<=33?this.powerups.push(this.powerup("knockback")):t<=66&&e.player.getHealth()<e.player.getMaxHealth()-10?this.powerups.push(this.powerup("health")):this.powerups.push(this.powerup("infiniteFuel"))}function o(t){var n={};n.type=t,n.width=20,n.height=20,n.angle=0,n.position=e.Vector(e.randInt(0,e.map.width),e.randInt(0,e.map.height));switch(t){case"knockback":n.TTL=12e3,n.color="blue",n.effectLength=1e4,n.description="No knockback",n.image=e.images("knockback");break;case"health":n.TTL=12e3,n.color="green",n.description="50 Health",n.image=e.images("healthPack");break;case"infiniteFuel":n.TTL=12e3,n.color="purple",n.effectLength=1e4,n.description="Unlimted Fuel",n.image=e.images("infiniteFuel")}return n}var t=new Audio("audio/powerup.ogg");return t.volume=.5,{update:n,render:i,lastSpawn:0,spawnPowerup:s,powerups:[],powerup:o,announcePowerup:r,sound:t}}),define("update",["hud","powerups"],function(e,t){function r(r){this.game.started?this.isPaused()||(n=this,r/=1e3,this.player.update(r),this.bullets.update(r),t.update(r),this.ship.update(r),e.update(),this.score.update(r)):this.game.starting&&(this.game.startTimeLeft>0?this.game.startTimeLeft-=r:(this.game.started=!0,this.game.starting=!1))}var n;return r}),define("render",["hud","powerups"],function(e,t){return function(n){function s(n,s){r.drawImage(this.images("background"),0,this.map.height-this.images("background").height),t.render(r),this.player.render(r),this.ship.render(r),this.bullets.render(r),r.drawImage(this.images("rooftop"),0,this.map.height),e.render(i),this.startGameButton.render(r),this.score.render(r),this.isPaused()&&(r.drawText("Game Paused",this.map.width/2,this.map.height/2,"30px","black","center","middle"),r.drawText("(Press p to resume)",this.map.width/2,this.map.height/2+40,"30px","black","center","middle")),this.game.starting&&(r.drawText("Get Ready!!!",this.map.width/2,this.map.height/2,"30px","black","center","middle"),r.drawText(Math.ceil(this.game.startTimeLeft/1e3),this.map.width/2,this.map.height/2+40,"30px","black","center","middle"))}var r=n.canvas,i=n.hud;return s}}),define("constants",["head-on"],function(e){return{gravity:e.Vector(0,30),leftWall:function(){return{position:e.Vector(0,0),width:20,height:e.map.height,angle:0}},topWall:function(){return{position:e.Vector(0,0),width:e.map.width,height:1,angle:0}},rightWall:function(){return{position:e.Vector(e.map.width,0),width:1,height:e.map.height,angle:0}},bottomWall:function(){return{position:e.Vector(e.map.height,0),width:e.map.width,height:1,angle:0}}}}),define("entity",["head-on"],function(e){function t(t){return e.collides(this,t)}function n(e){e.drawImageRotated(this.image,this.position.x,this.position.y,this.angle)}function r(){var t=Math.cos(this.angle),n=Math.sin(this.angle),r=this.width/2,i=this.height/2;this.midPoint=e.Vector(this.position.x+r*t-i*n,this.position.y+r*n+i*t)}return{collides:t,calcMidPoint:r}}),define("shield",["head-on"],function(e){function s(e){e>n?t=maxhealth:t=e}function o(){return t}function u(e){t=e*(t/n),n=e}function a(){return n}function f(e){var n=this,i;return t-e<0?(i=e-t,t=0):(t-=e,i=0),this.lastHit=Date.now(),r.pause(),i}function l(e){Date.now()-this.lastHit>this.rechargeTimeout&&(t<n?(r.paused&&(i||(r.currentTime=0,i=!1),r.play()),t+this.rechargeRate*e>n?t=n:t+=this.rechargeRate*e):r.pause()),n<200&&this.setMaxHealth(n+e/10)}var t=50,n=50,r=new Audio("audio/shield_recharge.ogg"),i=!1;return r.volume=.2,e.events.listen("pause",function(){r.pause(),i=!0}),{setHealth:s,getHealth:o,setMaxHealth:u,getMaxHealth:a,damage:f,damaged:!1,rechargeTimeout:3e3,update:l,rechargeRate:20,lastHit:0}}),define("jetpack",["head-on"],function(e){return function(e){var t,n,r,i,s=3e3,o;return{useFuel:function(e){t-=r*e,t<0&&(t=0),o=Date.now(),this.refuel=!1,this.lastTimeUp=Date.now()},setRefuelPerSecond:function(e){i=e},setFuelPerSecond:function(e){r=e},setMaxFuel:function(e){t*=e/n,n=e},setFuel:function(e){e>n?t=n:t=e},getMaxFuel:function(){return n},getFuel:function(){return Math.floor(t)},update:function(r){var u=this;if(e.onGround||this.refuel)t+=i*r,t>n&&(t=n);this.getFuel()<=0&&Date.now()-o>s&&(u.refuel=!0),n<1e3&&(n+=r/5)}}}}),define("player",["head-on","constants","entity","shield","jetpack"],function(e,t,n,r,i){function a(){return s}function f(e){e>o?s=o:s=e}function l(){return o}function c(e){s=e*(s/o),o=e}function h(e){var t,n=this;this.keepInBounds(e),this.move(e),this.jetpack.update(e),this.jetpack.getFuel()<=0&&this.turbo(!0),this.gravity(e),this.position=this.position.add(this.v.mul(e)),this.setImage(),this.calcMidPoint(),this.shield.update(e),this.updatePowerups(e)}function p(e){var t;for(key in this.powerups)this.powerups.hasOwnProperty(key)&&(t=this.powerups[key],t.active&&(t.effectLength-=e*1e3,t.effectLength<=0&&this.removePowerup(t)))}function d(){this.jetpack=i(this),this.image=e.images("dudeSitRight"),this.width=this.image.width,this.height=this.image.height,this.setHealth(this.getMaxHealth()),this.jetpack.setMaxFuel(700),this.jetpack.setFuel(700),this.jetpack.setFuelPerSecond(7),this.jetpack.setRefuelPerSecond(150),this.shield.setMaxHealth(50),this.shield.setHealth(1),this.position=e.Vector(30,e.map.height-this.height),this.v=e.Vector(0,0),this.angle=0,this.ax=e.Vector(400,0),this.ay=e.Vector(0,400),this.maxV=700,this.shieldHitSound=new Audio("audio/shield_hit.ogg"),this.shieldHitSound.volume=.3,this.gruntSound=new Audio("audio/grunt.ogg"),this.gruntSound.volume=.5,e.events.listen("keypress",function(e){this.keys(e)}.bind(this))}function v(e){e===82&&this.turbo()}function m(t){this.turboActive||t?(this.turboActive=!1,!this.powerups.infiniteFuel.active&&this.jetpack.setFuelPerSecond(7),this.ax=e.Vector(400,0),this.ay=e.Vector(0,400)):(this.turboActive=!0,!this.powerups.infiniteFuel.active&&this.jetpack.setFuelPerSecond(50),this.ay=e.Vector(0,1e3),this.ax=e.Vector(1e3,0))}function g(e,t){e.active=!1,e.type==="infiniteFuel"&&(this.turboActive?this.jetpack.setFuelPerSecond(50):this.jetpack.setFuelPerSecond(7))}function y(){this.v.length()>this.maxV&&(this.v=this.v.normalize().mul(this.maxV))}function b(t){e.keys.up&&this.jetpack.getFuel()>0&&(this.v=this.v.sub(this.ay.mul(t)),this.jetpack.useFuel(t)),e.keys.down&&this.jetpack.getFuel()>0&&!this.onGround&&(this.v.y<0&&(this.v=this.v.add(e.Vector(0,1e3).mul(t))),this.v=this.v.add(this.ay.mul(t)),this.jetpack.useFuel(t)),e.keys.right&&(!this.onGround&&this.jetpack.getFuel()>0?(this.jetpack.useFuel(t),this.v=this.v.add(this.ax.mul(t))):this.onGround&&(this.v=this.v.add(this.ax.mul(t)))),e.keys.left&&(!this.onGround&&this.jetpack.getFuel()>0?(this.jetpack.useFuel(t),this.v=this.v.sub(this.ax.mul(t))):this.onGround&&(this.v=this.v.sub(this.ax.mul(t)))),this.speedLimit()}function w(){this.hitTime?Date.now()-this.hitTime>500&&(this.hitTime=!1):this.v.x>0?(this.image=e.images("dudeLeanRight"),this.facing="right"):this.v.x<0?(this.image=e.images("dudeLeanLeft"),this.facing="left"):this.v.x==0&&(this.facing==="left"?this.image=e.images("dudeSitLeft"):this.image=e.images("dudeSitRight")),this.jetpack.getFuel()<=0||this.jetpack.getFuel()<=this.jetpack.getMaxFuel/10&&this.ranOutOfFuel?(this.ranOutOfFuel=!0,this.facing==="left"?this.image=e.images("outOfFuelLeft"):this.image=e.images("outOfFuelRight")):this.ranOutOfFuel=!1,this.width=this.image.width,this.height=this.image.height}function E(e){this.v=this.v.add(t.gravity.mul(e))}function S(t){this.position.y>=e.map.height-this.height?this.v.x*=Math.pow(.2,t):this.v.x*=Math.pow(.9,t),this.position.y>=e.map.height-this.height&&this.v.y>=0?(this.position.y=e.map.height-this.height,this.v.y=0,this.onGround=!0):this.onGround=!1,this.position.y<=0&&(this.position.y=0,this.v.y=0),this.position.x>=e.map.width-this.width?(this.v.x=0,this.position.x=e.map.width-this.width):this.position.x<=0&&(this.v.x=0,this.position.x=0);if(correction=this.collides(e.ship))correction.normal.x&&(this.v.x=0),correction.normal.y&&(this.v.y=0),this.position=this.position.sub(e.Vector(correction.normal.x,correction.normal.y).mul(correction.overlap))}function x(t){var n,r,i=s;n=this.position.sub(t.position).normalize(),t.type==="normal"&&(r=150,s-=this.shield.damage(10)),t.type==="seeker"&&(r=300,s-=this.shield.damage(30)),t.type==="bigBoy"&&(s-=this.shield.damage(50),r=500),this.powerups.knockback.active||(this.v=n.mul(r),this.image=e.images("dudeHit"),this.hitTime=Date.now()),s<=.9&&(e.startGameButton.activate(!0),e.game.gameOver=!0,e.game.started=!1),s===i?(this.shieldHitSound.currentTime=0,this.shieldHitSound.play()):(this.gruntSound.currentTime=0,this.gruntSound.play()),this.hitCount+=1,e.events.trigger("playerHit")}function T(e){switch(e.type){case"knockback":this.powerups.knockback=e,this.powerups.knockback.active=!0;break;case"health":this.setHealth(this.getHealth()+50);break;case"infiniteFuel":this.jetpack.setFuelPerSecond(0),this.jetpack.setFuel(this.jetpack.getFuel()+10),e.active=!0,this.powerups.infiniteFuel=e}}function N(e){var t;e.drawImage(this.image,this.position.x,this.position.y),this.turboActive&&e.drawText("TURBO!",10,30,"20px","red")}var s=1,o=100,u=e.entity({hitCount:0,getHealth:a,setHealth:f,getMaxHealth:l,setMaxHealth:c,update:h,type:"player",hit:x,render:N,move:b,keepInBounds:S,gravity:E,shield:r,powerup:T,powerups:{knockback:{},infiniteFuel:{}},removePowerup:g,init:d,setImage:w,speedLimit:y,updatePowerups:p,keys:v,turbo:m},n);return u}),define("seekerBullet",["head-on"],function(e,t){function n(t){var n;this.TTL-=t*1e3,this.TTL<=0&&this.explode(),this.exploding||(Date.now()-this.created>500?(n=Math.atan2(e.player.midPoint.y-this.position.y,e.player.midPoint.x-this.position.x)-this.angle,Math.abs(n)>Math.PI&&(n-=r(n)*Math.PI*2),this.angle+=n*.045,this.position.x+=this.speed*t*Math.cos(this.angle),this.position.y+=this.speed*t*Math.sin(this.angle)):this.position=this.position.add(this.v.mul(t)),this.calcMidPoint(),this.collides(e.player)&&(this.destroy("collide",e.player),e.player.hit(this)),e.collides(this,{angle:0,position:{y:e.map.height,x:0},width:e.map.width,height:5})&&this.explode())}function r(e){return e?e<0?-1:1:0}function i(t){var n=this;this.speed=700,this.position=t||e.Vector(e.map.width+100,e.map.height/2),this.heading=e.player.position.sub(this.position).normalize(),this.v=this.heading.mul(400),this.angle=Math.atan2(this.heading.y,this.heading.x),this.image=e.images("seekerBullet"),this.width=this.image.width,this.height=this.image.height,this.TTL=7e3,this.created=Date.now()}function s(e,t){e==="collide"&&t.type==="player"&&this.explode(),e==="exploded"&&(this.destroyed=!0)}return{update:n,init:i,destroy:s,type:"seeker"}}),define("big-boyBullet",["head-on","constants"],function(e,t){function n(t){var n;this.exploding?t.drawCircle(this.midPoint.x,this.midPoint.y,this.iteration,"transparent",{color:"red",width:"2px"}):(this.image=Math.sin(this.TTL/Math.pow(this.TTL/400,2))>0?e.images("bigBoy1"):e.images("bigBoy2"),this.super.render.call(this,t))}function r(t){this.position=t,this.heading=e.player.midPoint.sub(this.position).normalize(),this.angle=Math.atan2(this.heading.y,this.heading.x),this.v=this.heading.mul(this.speed),this.image=e.images("bigBoy1"),this.width=this.image.width,this.height=this.image.height,this.sound=new Audio("audio/bullets/big_boy_countdown.ogg"),this.explodeSound=new Audio("audio/bullets/big_boy_explosion.ogg"),this.sound.volume=.3,this.explodeSound.volume=.2,this.sound.play()}function i(e,t){t=t||{},e==="timeout"?this.explode():e==="collide"&&t.type==="player"&&this.explode(),e==="exploded"&&(this.destroyed="true")}function s(t){var n=this;this.TTL-=t*1e3,this.TTL<=0&&this.destroy("timeout"),this.exploding?this.playerHit||e.getPoints(e.player).some(function(t){if(o(n.midPoint.x,n.midPoint.y,n.iteration,t[0],t[1]))return e.player.hit(n),n.playerHit=!0,!0}):(this.position=this.position.add(this.v.mul(t)),this.calcMidPoint(),this.collides(e.player)&&(this.playerHit=!0,e.player.hit(this),this.destroy("collide",e.player)))}function o(e,t,n,r,i){return Math.pow(e-r,2)+Math.pow(t-i,2)<Math.pow(n,2)}return{render:n,init:r,update:s,type:"bigBoy",destroy:i,width:100,height:50,explosionIterations:200,speed:150,TTL:5e3,explosionLength:200}}),define("normalBullet",["head-on","constants"],function(e,t){function n(t){if(!this.exploding){this.position=this.position.add(this.v.mul(t)),this.calcMidPoint();if(this.position.x+this.width<=0||this.position.y+this.height<=0)this.destroyed=!0;e.collides(this,{angle:0,position:{y:e.map.height,x:0},width:e.map.width,height:5})&&this.explode(),this.collides(e.player)&&(this.destroy("collide",e.player),e.player.hit(this))}}function r(t){var n=700;this.position=t||e.Vector(e.map.width+100,e.map.height/2),this.heading=e.player.midPoint.sub(this.position).normalize(),this.angle=o(this),this.v=this.heading.mul(n),this.image=e.images("normalBullet"),this.explodeSound=new Audio("")}function i(e,t){e==="collide"&&this.explode(),e==="exploded"&&(this.destroyed=!0)}function s(){return e.randInt(e.player.y-20,e.player.y+e.player.height+20)}function o(e){return Math.atan2(e.heading.y,e.heading.x)}return{update:n,init:r,type:"normal",destroy:i,width:20,height:10,prevX:0,prevY:0,heading:{}}}),define("bullets",["head-on","seekerBullet","big-boyBullet","normalBullet","entity"],function(e,t,n,r,i){function h(t){o.forEach(function(n,r){n.destroyed&&(o.splice(r,1),e.events.trigger("bulletDestroyed")),n.update(t),o.some(function(e,t){if(n.collides(e)&&r!==t&&!n.exploding&&!e.exploding)return n.destroy("collide",e),e.destroy("collide",n),!0})})}function p(t,n,r){var i;for(var s=0;s<t;s++)i=e.entity(l[n],c),i.super=c,i.init(r),o.push(i),f++}function d(e){o.forEach(function(t){t.render(e)})}function v(){var t=0,n=this.explosionIterations||8,r,i=this,s=Math.ceil(this.explosionLength/n);if(this.exploding)return;this.exploding=!0,this.explodeSound&&this.explodeSound.play(),this.sound&&this.sound.pause(),r=setInterval(function(){if(!e.isPaused()){if(t>n){clearInterval(r),i.destroy("exploded");return}i.iteration=t,t++}},s)}function m(t){var n;this.exploding?(n=e.images("exp"+this.iteration),t.drawImage(n,this.midPoint.x-n.width/2,this.midPoint.y-n.height/2)):t.drawImageRotated(this.image,this.angle*180/Math.PI+180,this.position.x,this.position.y)}var s=arguments,o=[],u=Math.cos,a=Math.sin,f=0,l={seeker:t,bigBoy:n,normal:r},c={x:0,y:0,vx:0,vy:0,width:10,height:10,destroyed:!1,explode:v,bullets:o,render:m,explosionLength:200};return c=e.entity(c,i),{update:h,create:p,render:d,count:function(){return o.length},created:function(){return f},reset:function(){o.length=0}}}),define("cannon",["head-on","bullets","entity"],function(e,t,n){function r(t){var n=this.angle;this.position=this.ship.position.add(this.localPosition),this.heading=e.player.position.sub(this.position),this.angle=Math.atan2(this.heading.y,this.heading.x),this.calcMidPoint()}function i(){t.create(1,this.barrell,this.position),this.loaded=!1,this.loading=!1,this.sound.volume=.7,this.sound.play(),this.justFired=!0,this.smokeImg=1}function s(t){var n=this;this.barrell=t,this.loading=!0,t==="seeker"?this.loadTime=4e3:t==="bigBoy"?this.loadTime=5e3:this.loadTime=3e3,setTimeout(function(){n.loaded=!0},this.loadTime+e.randInt(0,500))}function o(t){var n;this.justFired&&(this.justFired=!1,this.smokeAnimation=!0,this.animationPos={},this.animationPos.x=this.position.x,this.animationPos.y=this.position.y,this.smokeInterval=setInterval(function(){this.smokeImg>3?(clearInterval(this.smokeInterval),this.smokeAnimation=!1):this.smokeImg+=1}.bind(this),100)),this.smokeAnimation&&(n=e.images("cannonSmoke"+this.smokeImg),t.drawImage(n,this.animationPos.x-n.width,this.animationPos.y-this.height))}return function(t,u,a){var f=3e3,l,c,h,p;return h=t.position.add(u),c=e.player.position.sub(h),p={update:r,render:o,fire:i,load:s,width:40,height:20,loaded:!1,loading:!1,ship:t,localPosition:u,position:h,loadTime:f,sound:new Howl({urls:["audio/cannon.ogg"],volume:.3,buffer:!0})},a&&(p.loaded=!0,p.barrell=a),p=e.entity(p,n),p}}),define("ship",["head-on","entity","cannon"],function(e,t,n){function i(t){this.updateCannons(),this.fireCannons(),this.direction=e.player.position.sub(this.position).normalize().y,this.direction>0?this.direction=1:this.direction=-1,this.position.y>=0&&this.position.y+this.height<=e.map.height-20?this.position=this.position.add(this.v.mul(this.direction).mul(t)):this.position.y<0?this.position.y=0:this.position.y+this.height>e.map.height-20&&(this.position.y=e.map.height-this.height-20),this.cannonFireTimeout>500&&(this.cannonFireTimeout-=t*10)}function s(e){e.drawImage(this.image,this.position.x,this.position.y),this.cannons.forEach(function(t){t.render(e)})}function o(e){this.cannons.forEach(function(t){var n=Math.random();t.update(e),!t.loading&&!t.loaded&&(n<.05?t.load("seeker"):n<=.1&&n>=.05?t.load("bigBoy"):t.load("normal"))})}function u(e){var t=this.cannons[this.currentCannon],n=0;if(Date.now()-this.waitForNextFire>this.cannonFireTimeout){while(!t.loaded&&n<this.cannons.length)this.currentCannon=(this.currentCannon+1)%this.cannons.length,t=this.cannons[this.currentCannon],n++;n<this.cannons.length&&t.fire(),this.currentCannon=(this.currentCannon+1)%this.cannons.length,this.waitForNextFire=Date.now()}}function a(){this.currentCannon=0,this.waitForNextFire=Date.now(),this.position=e.Vector(800,0),this.image=e.images("ship"),this.width=this.image.width,this.height=this.image.height,this.angle=0,this.cannonFireTimeout=3e3,this.cannons.push(n(this,e.Vector(70,190))),this.cannons.push(n(this,e.Vector(90,190))),this.cannons.push(n(this,e.Vector(110,190))),this.cannons.push(n(this,e.Vector(130,190))),this.cannons.push(n(this,e.Vector(150,190))),this.cannons.push(n(this,e.Vector(170,190)))}var r=e.entity({update:i,render:s,cannons:[],init:a,direction:1,v:e.Vector(0,40),updateCannons:o,fireCannons:u,cannonFireTimeout:1500},t);return r}),define("keys",["head-on"],function(e){return function(t){e.keys={};var n={87:"up",68:"right",65:"left",83:"down"};window.addEventListener("keydown",function(t){e.keys[n[t.which]]=!0}),window.addEventListener("keyup",function(t){e.keys[n[t.which]]=!1,e.events.trigger("keypress",t.which),t.which===80&&(e.isPaused()?e.unpause():e.pause())}),t.addEventListener("click",function(n){var r=t.getBoundingClientRect();e.events.trigger("click",{x:n.pageX-r.left,y:n.pageY-r.top})}),t.addEventListener("mousemove",function(n){var r=t.getBoundingClientRect();e.events.trigger("mousemove",{x:n.pageX-r.left,y:n.pageY-r.top})})}}),define("buttons",["head-on"],function(e){return function(){e.startGameButton=e.entity({width:200,height:100,angle:0,active:!0,color:"#1C1CED",text:"Start Game",position:e.Vector(e.map.width/2-100,e.map.height/2-50),render:function(t){!e.game.started&&!e.game.gameOver&&!e.game.starting&&(t.drawRect(this.width,this.height,this.position.x,this.position.y,this.color),t.drawText("Start Game",this.position.x+this.width/2,this.position.y+this.height/2,"20px","white","center","middle")),!e.game.started&&e.game.gameOver&&!e.game.starting&&(t.drawRect(this.width,this.height,this.position.x,this.position.y,this.color),t.drawText("Retry",this.position.x+this.width/2,this.position.y+this.height/2,"20px","white","center","middle"))},click:function(){!e.game.gameOver&&!e.game.started&&!e.game.starting&&(this.active=!1,e.game.starting=!0,e.game.startTimeLeft=2e3),e.game.gameOver&&!e.game.started&&!e.game.starting&&(this.active=!1,e.events.trigger("reset")),e.canvas("main").canvas.canvas.style.cursor=""},activate:function(e){this.active=e},init:function(){var t=this;e.events.listen("click",function(n){var n={width:2,height:2,angle:0,position:e.Vector(n.x,n.y)};e.collides(n,t)&&t.click()}),e.events.listen("mousemove",function(n){var n={width:2,height:2,angle:0,position:e.Vector(n.x,n.y)};t.active&&(e.collides(n,t)?(e.canvas("main").canvas.canvas.style.cursor="pointer",t.color="#1313C2"):(e.canvas("main").canvas.canvas.style.cursor="",t.color="#1C1CED"))})}})}}),define("score",["head-on","bullets"],function(e,t){return{update:function(e){this.score+=e},init:function(){this.score=0,this.playerStats={hits:0},e.events.listen("playerHit",function(){this.score-=70}.bind(this)),e.events.listen("bulletDestroyed",function(){this.score+=20}.bind(this)),e.events.listen("powerup",function(){this.score+=20}.bind(this))},render:function(t){t.drawText("Score: "+Math.round(this.score),e.map.width/2,20,"20px","black","center")},reset:function(){this.score=0}}}),define("init",["head-on","player","ship","keys","bullets","buttons","score"],function(e,t,n,r,i,s,o){return window.addEventListener("blur",function(){e.game.started&&e.pause()}),function(u,a){return e.canvas.create("main",u,a),e.canvas.create("hud",u,150),e.canvas.create("background",u,a),e.map={},e.player=t,e.ship=n,e.bullets=i,e.map.width=u,e.map.height=a-10,e.canvas("main").append("#game-contain"),e.canvas("hud").append("#game-contain"),e.score=o,s(),e.startGameButton.init(),e.game={},e.game.started=!1,e.game.gameOver=!1,e.loadImages([{name:"normalBullet",src:"img/normal_bullet_2.png"},{name:"rooftop",src:"img/rooftop.png"},{name:"background",src:"img/background.png"},{name:"seekerBullet",src:"img/seeker_bullet_2.png"},{name:"dudeLeanRight",src:"img/dude_lean_right.png"},{name:"dudeHit",src:"img/dude_hit.png"},{name:"dudeLeanLeft",src:"img/dude_lean_left.png"},{name:"dudeSitLeft",src:"img/dude_sitting_left.png"},{name:"dudeSitRight",src:"img/dude_sitting_right.png"},{name:"outOfFuelLeft",src:"img/dude_front_left.png"},{name:"outOfFuelRight",src:"img/dude_front_right.png"},{name:"ship",src:"img/ship.png"},{name:"bigBoy1",src:"img/big_boy_color_1.png"},{name:"bigBoy2",src:"img/big_boy_color_2.png"},{name:"exp1",src:"img/exp_1.png"},{name:"exp2",src:"img/exp_2.png"},{name:"exp3",src:"img/exp_3.png"},{name:"exp4",src:"img/exp_4.png"},{name:"exp5",src:"img/exp_5.png"},{name:"exp6",src:"img/exp_6.png"},{name:"exp7",src:"img/exp_7.png"},{name:"exp8",src:"img/exp_8.png"},{name:"cannonSmoke1",src:"img/cannon_smoke_1.png"},{name:"cannonSmoke2",src:"img/cannon_smoke_2.png"},{name:"cannonSmoke3",src:"img/cannon_smoke_3.png"},{name:"healthPack",src:"img/health_pack.png"},{name:"knockback",src:"img/knockback.png"},{name:"infiniteFuel",src:"img/infinite_fuel.png"}],!1,function(){t.init(),e.ship.init(),o.init(),document.querySelectorAll(".loading")[0].style.display="none"}),r(e.canvas("main").canvas.canvas),{canvas:e.canvas("main"),hud:e.canvas("hud")}}}),require(["head-on","update","render","init"],function(e,t,n,r){canvases=r(1200,700),e.events.listen("reset",function(){e.player.init(),e.ship.init(),e.bullets.reset(),e.game.starting=!0,e.game.gameOver=!1,e.game.startTimeLeft=5e3,e.score.reset()}),e.update(t),e.render(n(canvases)),e.run()}),define("game",function(){});