define("head-on",[],function(){return window.headOn}),function(e,t){var n=function(){function r(e){return Object.keys(e).length===0}var t,n={groups:{},_images:{},fps:50,imagesLoaded:!0,gameTime:0,_update:"",_render:"",_ticks:0,randInt:function(e,t){return Math.floor(Math.random()*(t+1-e))+e},randFloat:function(e,t){return Math.random()*(t-e)+e},events:{events:{},listen:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},trigger:function(e){var t=[].splice.call(arguments,1),r=this.events[e],i,s;if(r){i=r.length;for(s=0;s<i;s++)r[s].call(n,t)}}},animate:function(e,t,n){var r,i,s=0;e.animating||(e.animating=!0,e.image=t[0],r=this,i=setInterval(function(){t.length===s?(n(),e.animating=!1,e.image="",clearInterval(i)):(s+=1,e.image=t[s])},1e3/this.fps))},update:function(e){this._update=e},render:function(e){this._render=e},entity:function(e,t){var n,r,i;t&&typeof t=="object"?r=Object.create(t):r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r},collides:function(e,t){var n=this.getPoints(e),r=this.getPoints(t),i=0,s=n.length,o,u=r.length,a={x:0,y:0},f,l,c,h,p,d,v=null,m=null,g=null,y,b,w;for(;i<s;i++){b=n[i==s-1?0:i+1],w=n[i],a.x=-(b[1]-w[1]),a.y=b[0]-w[0],f=Math.sqrt(a.x*a.x+a.y*a.y),a.x/=f,a.y/=f,l=c=-1,h=p=-1;for(o=0;o<s;++o){y=n[o][0]*a.x+n[o][1]*a.y;if(y>h||h===-1)h=y;if(y<l||l===-1)l=y}for(o=0;o<u;++o){y=r[o][0]*a.x+r[o][1]*a.y;if(y>p||p===-1)p=y;if(y<c||c===-1)c=y}l<c?(d=c-h,a.x=-a.x,a.y=-a.y):d=l-p;if(d>=0)return!1;if(v===null||d>v)v=d,g={x:a.x,y:a.y}}for(i=0;i<u;i++){b=r[i==u-1?0:i+1],w=r[i],a.x=-(b[1]-w[1]),a.y=b[0]-w[0],f=Math.sqrt(a.x*a.x+a.y*a.y),a.x/=f,a.y/=f,l=c=-1,h=p=-1;for(o=0;o<s;++o){y=n[o][0]*a.x+n[o][1]*a.y;if(y>h||h===-1)h=y;if(y<l||l===-1)l=y}for(o=0;o<u;++o){y=r[o][0]*a.x+r[o][1]*a.y;if(y>p||p===-1)p=y;if(y<c||c===-1)c=y}l<c?(d=c-h,a.x=-a.x,a.y=-a.y):d=l-p;if(d>=0)return!1;if(v===null||d>v)v=d;if(d>m||m===null)m=d,g={x:a.x,y:a.y}}return{overlap:m,normal:g}},getPoints:function(e){var t=e.position.x,n=e.position.y,r=e.width,i=e.height,s=e.angle,o=this,u=[];return u[0]=[t,n],u[1]=[],u[1].push(Math.sin(-s)*i+t),u[1].push(Math.cos(-s)*i+n),u[2]=[],u[2].push(Math.cos(s)*r+u[1][0]),u[2].push(Math.sin(s)*r+u[1][1]),u[3]=[],u[3].push(Math.cos(s)*r+t),u[3].push(Math.sin(s)*r+n),u},group:function(e,t){return this.groups[e]?t&&this.groups[e].push(t):(this.groups[e]=[],t&&this.groups[e].push(t)),this.groups[e]},loadImages:function(e,t,n){var r,i,s,o,u,a,f,l,c;f=this,this.imagesLoaded=!1,s=e.length,s||(this.imagesLoaded=!0),o=0,c=function(){o+=1,t&&t(image.name),o===s&&(n&&allCallBack,f.imagesLoaded=!0)},e.forEach(function(e){i=new Image,i.src=e.src,i.onload=c,f._images[e.name]=i})},images:function(e){return this._images[e]?this._images[e]:new Image},onTick:function(e){var t=Date.now(),n=t-e;this.trueFps=1/(n/1e3),this._ticks+=1,this._update(n,this._ticks),this._render(n,this._ticks),this.gameTime+=n},timeout:function(e,t,n){setTimeout(function(){e.call(n)},t)},interval:function(e,t,n){return setInterval(function(){e.call(n)},t)},canvas:function(e){return this===n?new this.canvas(e):(this.canvas=this.canvases[e],this.width=this.canvas.width,this.height=this.canvas.height,this)},Vector:function(e,n){var r=this.entity({x:e,y:n},t);return r},run:function(){function r(){t.imagesLoaded&&(t.onTick(n),n=Date.now()),e.requestAnimationFrame(r)}var t=this,n=Date.now();e.requestAnimationFrame(r)}};return n.canvas.create=function(e,t,n){var r,i;r=document.createElement("canvas"),r.width=t,r.height=n,i=r.getContext("2d"),this.prototype.canvases[e]={canvas:r,ctx:i,width:r.width,height:r.height}},n.canvas.prototype={canvases:{},stroke:function(e){var t=this.canvas.ctx;t.save(),e&&(t.lineWith=e.width,t.strokeStyle=e.color,t.stroke()),t.restore()},drawRect:function(e,t,n,i,s,o,u){var a=this.canvas.ctx,f=1;return a.save(),a.beginPath(),u?(a.translate(n,i),a.rotate(u),a.rect(0,0,e,t)):a.rect(n,i,e,t),s&&(a.fillStyle=s),a.fill(),typeof o=="object"&&!r(o)&&this.stroke(o),a.closePath(),a.restore(),this},drawCircle:function(e,t,n,r,i){var s=this.canvas.ctx;return s.save(),s.beginPath(),s.arc(e,t,n,0,2*Math.PI,!1),s.fillStyle=r||"black",s.fill(),this.stroke(i),s.restore(),s.closePath(),this},drawImage:function(e,t,n){var r=this.canvas.ctx;return r.drawImage(e,t,n),this},drawImageRotated:function(e,t,n,r){var i=this.canvas.ctx,s=t*Math.PI/180;return i.save(),i.translate(n,r),i.rotate(s),i.drawImage(e,0-e.width,0-e.height),i.restore(),this},drawText:function(e,t,n,r,i,s,o){var u=this.canvas.ctx;return u.save(),r&&(u.font=r+" sans-serif"),i&&(u.fillStyle=i),s&&(u.textAlign=s),o&&(u.textBaseline=o),u.fillText(e,t,n),u.restore(),this},append:function(e){return document[e].appendChild(this.canvas.canvas),this}},t={normalize:function(){var e=this.length();return n.Vector(this.x/e,this.y/e)},normalizeInPlace:function(){var e=this.length();this.x/=e,this.y/=e},dot:function(e){return e.x*this.x+e.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},sub:function(e){return n.Vector(this.x-e.x,this.y-e.y)},add:function(e){return n.Vector(this.x+e.x,this.y+e.y)},mul:function(e){return n.Vector(this.x*e,this.y*e)}},n}();e.headOn=n}(window),define("seekerBullet",["head-on"],function(e,t){function n(t){this.TTL-=t*1e3,this.TTL<=0&&this.explode();if(!this.exploding){if(Date.now()-this.created>500){var n;n=Math.atan2(e.player.position.y+e.player.height/2-this.position.y,e.player.position.x+e.player.width/2-this.position.x)-this.angle,this.angle+=n*.05,this.position.x+=this.speed*t*Math.cos(this.angle),this.position.y+=this.speed*t*Math.sin(this.angle)}else this.position=this.position.add(this.v.mul(t));this.calcMidPoint(),this.collides(e.player)&&(this.destroy("collide",e.player),e.player.hit(this)),e.collides(this,{angle:0,position:{y:e.map.height,x:0},width:e.map.width,height:5})&&this.explode()}}function r(t){var n=this;this.speed=400,this.position=t||e.Vector(e.map.width+100,e.map.height/2),this.heading=e.player.position.sub(this.position).normalize(),this.v=this.heading.mul(400),this.angle=Math.atan2(this.heading.y,this.heading.x),this.image=e.images("seekerBullet"),this.width=this.image.width,this.height=this.image.height,this.TTL=5e3,this.created=Date.now()}function i(e,t){e==="collide"&&t.type==="player"&&this.explode(),e==="exploded"&&(this.destroyed=!0)}return{update:n,init:r,destroy:i,type:"seeker"}}),define("big-boyBullet",["head-on"],function(e){function t(e){var t;this.exploding?e.drawCircle(this.midPointx,this.midPointy,this.iteration,"transparent",{color:"red",width:"2px"}):(t=Math.sin(this.TTL/Math.pow(this.TTL/400,2))>0?"blue":"red",e.drawRect(this.width,this.height,this.position.x,this.position.y,t,!1,this.angle))}function n(){this.position=e.Vector(e.map.width,250),this.heading=e.player.position.sub(this.position).normalize(),this.angle=Math.atan2(this.heading.y,this.heading.x),this.v=this.heading.mul(this.speed)}function r(e,t){t=t||{},e==="timeout"?this.explode():e==="collide"&&t.type==="player"&&this.explode(),e==="exploded"&&(this.destroyed="true")}function i(t){var n=this;this.TTL-=t*1e3,this.TTL<=0&&this.destroy("timeout"),this.exploding?this.playerHit||e.getPoints(e.player).some(function(t){if(s(n.midPoint.x,n.midPoint.y,n.iteration,t[0],t[1]))return e.player.hit(n),n.playerHit=!0,!0}):(this.position=this.position.add(this.v.mul(t)),this.calcMidPoint(),this.collides(e.player)&&(this.playerHit=!0,e.player.hit(this),this.destroy("collide",e.player)))}function s(e,t,n,r,i){return Math.pow(e-r,2)+Math.pow(t-i,2)<Math.pow(n,2)}return{render:t,init:n,update:i,type:"bigBoy",destroy:r,width:100,height:50,explosionIterations:200,speed:200,TTL:3e3}}),define("constants",["head-on"],function(e){return{gravity:e.Vector(0,30)}}),define("normalBullet",["head-on","constants"],function(e,t){function n(t){if(!this.exploding){this.position=this.position.add(this.v.mul(t)),this.calcMidPoint();if(this.position.x+this.width<=0||this.position.y+this.height<=0)this.destroyed=!0;e.collides(this,{angle:0,position:{y:e.map.height,x:0},width:e.map.width,height:5})&&this.explode(),this.collides(e.player)&&(this.destroy("collide",e.player),e.player.hit(this))}}function r(t){var n=e.randInt(300,500);this.position=t||e.Vector(e.map.width+100,e.map.height/2),this.heading=e.player.position.sub(this.position).normalize(),this.angle=o(this),this.v=this.heading.mul(n),this.image=e.images("normalBullet")}function i(e,t){e==="collide"&&this.explode(),e==="exploded"&&(this.destroyed=!0)}function s(){return e.randInt(e.player.y-20,e.player.y+e.player.height+20)}function o(e){return Math.atan2(e.heading.y,e.heading.x)}return{update:n,init:r,type:"normal",destroy:i,width:20,height:10,prevX:0,prevY:0,heading:{}}}),define("entity",["head-on"],function(e){function t(t){return e.collides(this,t)}function n(){var t=Math.cos(this.angle),n=Math.sin(this.angle),r=this.width/2,i=this.height/2;this.midPoint=e.Vector(this.position.x+r*t-i*n,this.position.y+r*n+i*t)}return{collides:t,calcMidPoint:n}}),define("bullets",["head-on","seekerBullet","big-boyBullet","normalBullet","entity"],function(e,t,n,r,i){function h(t){o.forEach(function(n,r){n.destroyed&&o.splice(r,1),n.collides(e.ship)&&n.explode(),n.update(t),o.some(function(e,t){if(n.collides(e)&&r!==t&&!n.exploding&&!e.exploding)return n.destroy("collide",e),e.destroy("collide",n),!0})})}function p(t,n,r){var i;for(var s=0;s<t;s++)i=e.entity(l[n],c),i.init(r),o.push(i),f++}function d(e){o.forEach(function(t){t.render(e)})}function v(){var e=0,t=this.explosionIterations||50,n,r=this;if(this.exploding)return;this.exploding=!0,n=setInterval(function(){if(e>t){clearInterval(n),r.destroy("exploded");return}r.iteration=e,e++},20)}function m(e){this.exploding?e.drawCircle(this.position.x,this.position.y,this.iteration,"transparent",{color:"red",width:"2px"}):e.drawImageRotated(this.image,this.angle*180/Math.PI+180,this.position.x,this.position.y)}var s=arguments,o=[],u=Math.cos,a=Math.sin,f=0,l={seeker:t,bigBoy:n,normal:r},c={x:0,y:0,vx:0,vy:0,width:10,height:10,destroyed:!1,explode:v,bullets:o,render:m};return c=e.entity(c,i),{update:h,create:p,render:d,count:function(){return o.length},created:function(){return f}}}),define("hud",["head-on"],function(e){function r(r){r.canvas.ctx.clearRect(0,0,r.width,r.height),r.drawRect(n.width,n.height,n.x,n.y,"red"),r.drawRect(e.player.getHealth()/e.player.getMaxHealth()*n.width,n.height,n.x,n.y,"green"),r.drawRect(200,20,300,0,"black"),r.drawRect(e.player.shield.getHealth()/e.player.shield.getMaxHealth()*200,20,300,0,"purple"),e._ticks%50===0&&(t=Math.floor(e.trueFps)),r.drawText(t+" fps",r.width-30,40),r.drawText("Health: ("+Math.floor(e.player.getHealth())+"/"+e.player.getMaxHealth()+")",n.width/2+n.x,n.height/2+n.y,"15px","white","center","middle")}function i(){}var t,n={x:0,y:0,width:200,height:20};return{render:r,update:i}}),define("update",["bullets","hud"],function(e,t){function r(r){n=this,r/=1e3,this.player.update(r),e.update(r),this.ship.update(r),t.update()}var n;return r}),define("render",["bullets","hud"],function(e,t){return function(n){function s(n,s){r.drawRect(r.width,r.height,0,0,"white"),this.player.render(r),this.ship.render(r),e.render(r),r.drawRect(r.width,10,0,r.height-10,"blue"),t.render(i)}var r=n.canvas,i=n.hud;return s}}),define("keys",["head-on"],function(e){e.keys={};var t={87:"up",68:"right",65:"left",83:"down"};window.addEventListener("keydown",function(n){e.keys[t[n.which]]=!0}),window.addEventListener("keyup",function(n){e.keys[t[n.which]]=!1})}),define("shield",["head-on"],function(e){function r(e){e>n?t=maxhealth:t=e}function i(){return t}function s(e){n=e,t=e*(t/maxhealth)}function o(){return n}function u(e){var n=this,r;return this.timeout&&clearTimeout(this.timeout),t-e<0?(r=e-t,t=0):(t-=e,r=0),this.lastHit=Date.now(),r}function a(e){Date.now()-this.lastHit>this.rechargeTimeout&&t!==n&&(t+this.rechargeRate*e>n?t=n:t+=this.rechargeRate*e)}var t=50,n=50;return{setHealth:r,getHealth:i,setMaxHealth:s,getMaxHealth:o,damage:u,damaged:!1,rechargeTimeout:2e3,update:a,rechargeRate:20}}),define("player",["head-on","constants","entity","shield"],function(e,t,n,r){function u(){return i}function a(e){i=e}function f(){return s}function l(e){i=e*(i/s),s=e}function c(e){var t;this.keepInBounds(e),this.move(e),this.gravity(e),this.position=this.position.add(this.v.mul(e)),this.shield.update(e)}function h(t){e.keys.up&&(this.v=this.v.sub(this.ay.mul(t))),e.keys.down&&(this.v.y<0&&(this.v=this.v.add(e.Vector(0,1e3).mul(t))),this.v=this.v.add(this.ay.mul(t))),e.keys.right&&(this.v=this.v.add(this.ax.mul(t))),e.keys.left&&(this.v=this.v.sub(this.ax.mul(t)))}function p(e){this.v=this.v.add(t.gravity.mul(e))}function d(t){this.position.y>=e.map.height-this.height?this.v.x*=Math.pow(.2,t):this.v.x*=Math.pow(.9,t),this.position.y>=e.map.height-this.height&&this.v.y>=0?(this.position.y=e.map.height-this.height,this.v.y=0):this.position.y<=0&&(this.position.y=0,this.v.y=0),this.position.x>=e.map.width-this.width?(this.v.x=0,this.position.x=e.map.width-this.width):this.position.x<=0&&(this.v.x=0,this.position.x=0);if(correction=this.collides(e.ship))correction.normal.x&&(this.v.x=0),correction.normal.y&&(this.v.y=0),this.position=this.position.sub(e.Vector(correction.normal.x,correction.normal.y).mul(correction.overlap))}function v(e){var t,n;t=this.position.sub(e.position).normalize(),e.type==="normal"&&(n=150,i-=this.shield.damage(10)),e.type==="seeker"&&(n=300,i-=this.shield.damage(30)),e.type==="bigBoy"&&(i-=this.shield.damage(50),n=500),this.v=t.mul(n)}function m(e){var t;e.drawRect(this.width,this.height,this.position.x,this.position.y,"green",!1,this.angle)}var i=100,s=100,o=e.entity({position:e.Vector(0,0),v:e.Vector(0,0),angle:0,width:50,height:50,ax:e.Vector(200,0),ay:e.Vector(0,400),getHealth:u,setHealth:a,getMaxHealth:f,setMaxHealth:l,update:c,type:"player",hit:v,render:m,move:h,keepInBounds:d,gravity:p,shield:r},n);return o}),define("cannon",["head-on","bullets","entity"],function(e,t,n){function r(t){var n=this.angle;this.position=this.ship.position.add(this.localPosition),this.heading=e.player.position.sub(this.position),this.angle=Math.atan2(this.heading.y,this.heading.x),console.log(this.angle),this.angle>10*Math.PI/14||this.angle<Math.PI/6?(this.angle=n,this.canFire=!1):this.canFire=!0,this.calcMidPoint()}function i(){this.canFire&&(t.create(1,this.barrell,this.midPoint),this.loaded=!1,this.loading=!1)}function s(t){var n=this;this.barrell=t,this.loading=!0,t==="seeker"?this.loadTime=4e3:this.loadTime=3e3,setTimeout(function(){n.loaded=!0},this.loadTime+e.randInt(0,500))}function o(e){e.drawRect(this.width,this.height,this.position.x,this.position.y,"black",!1,this.angle)}return function(t,u){var a=3e3,f,l,c,h;return c=t.position.add(u),l=e.player.position.sub(c),h={update:r,render:o,fire:i,load:s,width:40,height:20,loaded:!1,loading:!1,ship:t,localPosition:u,position:c,loadTime:a},e.entity(h,n)}}),define("ship",["head-on","entity","cannon"],function(e,t,n){function i(t){this.cannons.forEach(function(n){n.update(t),!n.loading&&!n.loaded?e.randInt(0,100)<10?n.load("seeker"):n.load("normal"):n.loaded&&n.fire()})}function s(e){e.drawRect(this.width,this.height,this.position.x,this.position.y,"black"),this.cannons.forEach(function(t){t.render(e)})}function o(){this.position=e.Vector(600,0),this.width=200,this.height=200,this.angle=0,this.cannons.push(n(this,e.Vector(20,200))),this.cannons.push(n(this,e.Vector(60,200)))}var r=e.entity({update:i,render:s,cannons:[],init:o},t);return r}),define("init",["head-on","player","ship"],function(e,t,n){return function(r,i){return e.canvas.create("main",r,i),e.canvas.create("hud",r,200),e.map={},e.player=t,e.ship=n,e.ship.init(),e.map.width=r,e.map.height=i-10,e.canvas("main").append("body"),e.canvas("hud").append("body"),e.gameState={},e.gameState.spawnBullet=!0,{canvas:e.canvas("main"),hud:e.canvas("hud")}}}),require(["head-on","update","render","keys","init"],function(e,t,n,r,i){canvases=i(1e3,700),e.loadImages([{name:"normalBullet",src:"img/normalBullet.png"},{name:"seekerBullet",src:"img/seekerBullet.png"}]),e.update(t),e.render(n(canvases)),e.run()}),define("game",function(){});